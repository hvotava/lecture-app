{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>ğŸ“Š Pokrok uÅ¾ivatelÅ¯</h1>
    <a href="{{ request.url_for('admin_list_lessons') }}" class="btn btn-secondary">
        â† ZpÄ›t na lekce
    </a>
</div>

<div class="row mb-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5>ğŸ¯ PÅ™ehled systÃ©mu lekcÃ­</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <h6>ğŸ“ Lekce 0: VstupnÃ­ test</h6>
                        <ul class="list-unstyled">
                            <li>â€¢ 30 otÃ¡zek z obrÃ¡bÄ›cÃ­ch kapalin</li>
                            <li>â€¢ PoÅ¾adovÃ¡no 90% pro postup</li>
                            <li>â€¢ KonkrÃ©tnÃ­ definovanÃ© otÃ¡zky</li>
                        </ul>
                    </div>
                    <div class="col-md-4">
                        <h6>ğŸ“ Lekce 1: ZÃ¡klady</h6>
                        <ul class="list-unstyled">
                            <li>â€¢ Å kolnÃ­ obsah o kapalinÃ¡ch</li>
                            <li>â€¢ 10 nÃ¡hodnÃ½ch otÃ¡zek z obsahu</li>
                            <li>â€¢ PoÅ¾adovÃ¡no 90% pro postup</li>
                        </ul>
                    </div>
                    <div class="col-md-4">
                        <h6>ğŸš€ DalÅ¡Ã­ lekce</h6>
                        <ul class="list-unstyled">
                            <li>â€¢ AutomatickÃ© generovÃ¡nÃ­ obsahu</li>
                            <li>â€¢ PokroÄilÃ¡ tÃ©mata</li>
                            <li>â€¢ PostupnÃ½ rÅ¯st obtÃ­Å¾nosti</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="table-responsive">
    <table class="table table-striped">
        <thead>
            <tr>
                <th>ğŸ‘¤ UÅ¾ivatel</th>
                <th>ğŸ“ Telefon</th>
                <th>ğŸ¯ AktuÃ¡lnÃ­ ÃºroveÅˆ</th>
                <th>ğŸ“š AktuÃ¡lnÃ­ lekce</th>
                <th>ğŸ“Š PoÄet pokusÅ¯</th>
                <th>ğŸ•’ PoslednÃ­ aktivita</th>
                <th>âš¡ Akce</th>
            </tr>
        </thead>
        <tbody>
            {% for data in progress_data %}
            <tr>
                <td>
                    <strong>{{ data.user.name }}</strong>
                    <br><small class="text-muted">{{ data.user.language.upper() }}</small>
                </td>
                <td>
                    <code>{{ data.user.phone_number }}</code>
                </td>
                <td>
                    <span class="badge bg-{{ 'warning' if data.level == 0 else 'success' if data.level == 1 else 'primary' }}">
                        ÃšroveÅˆ {{ data.level }}
                    </span>
                </td>
                <td>
                    {% if data.level == 0 %}
                        <span class="badge bg-warning text-dark">ğŸ“ {{ data.lesson_name }}</span>
                        <br><small class="text-muted">MusÃ­ dosÃ¡hnout 90%</small>
                    {% elif data.level == 1 %}
                        <span class="badge bg-success">ğŸ“ {{ data.lesson_name }}</span>
                        <br><small class="text-muted">Å kolnÃ­ obsah</small>
                    {% else %}
                        <span class="badge bg-primary">ğŸš€ {{ data.lesson_name }}</span>
                        <br><small class="text-muted">PokroÄilÃ¡ ÃºroveÅˆ</small>
                    {% endif %}
                </td>
                <td>
                    <span class="badge bg-info">{{ data.attempts_count }}</span>
                    {% if data.attempts_count == 0 %}
                        <br><small class="text-muted">Å½Ã¡dnÃ© pokusy</small>
                    {% else %}
                        <br><small class="text-muted">Celkem pokusÅ¯</small>
                    {% endif %}
                </td>
                <td>
                    {% if data.user.created_at %}
                        {{ data.user.created_at.strftime('%d.%m.%Y') }}
                        <br><small class="text-muted">{{ data.user.created_at.strftime('%H:%M') }}</small>
                    {% else %}
                        <span class="text-muted">NeznÃ¡mÃ©</span>
                    {% endif %}
                </td>
                <td>
                    <a href="{{ request.url_for('admin_call_user_lesson', user_id=data.user.id, lesson_number=data.level) }}" 
                       class="btn btn-sm btn-outline-success" 
                       title="Zavolat uÅ¾ivateli s aktuÃ¡lnÃ­ lekcÃ­">
                        ğŸ“ Zavolat
                    </a>
                    {% if data.level > 0 %}
                        <br>
                        <a href="{{ request.url_for('admin_call_user_lesson', user_id=data.user.id, lesson_number=0) }}" 
                           class="btn btn-sm btn-outline-warning mt-1" 
                           title="Opakovat vstupnÃ­ test">
                            ğŸ”„ Opakovat test
                        </a>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% if progress_data|length == 0 %}
<div class="alert alert-info mt-4">
    <h5><i class="fas fa-info-circle"></i> Å½Ã¡dnÃ­ uÅ¾ivatelÃ©</h5>
    <p>ZatÃ­m nemÃ¡te Å¾Ã¡dnÃ© uÅ¾ivatele v systÃ©mu.</p>
    <a href="{{ request.url_for('admin_list_users') }}" class="btn btn-primary">
        PÅ™idat uÅ¾ivatele
    </a>
</div>
{% endif %}

<div class="mt-4">
    <div class="card">
        <div class="card-header">
            <h5>ğŸ”§ Jak systÃ©m funguje</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h6>ğŸ“ VstupnÃ­ test (Lekce 0):</h6>
                    <ol>
                        <li>AI vybere nÃ¡hodnou otÃ¡zku z 30 definovanÃ½ch</li>
                        <li>VyhodnotÃ­ odpovÄ›Ä podle sprÃ¡vnÃ© odpovÄ›di</li>
                        <li>PÅ™i 90%+ postup do Lekce 1</li>
                        <li>PÅ™i <90% opakovÃ¡nÃ­ testu</li>
                    </ol>
                </div>
                <div class="col-md-6">
                    <h6>ğŸ“ Å kolnÃ­ lekce (Lekce 1+):</h6>
                    <ol>
                        <li>AI vygeneruje 10 otÃ¡zek z obsahu lekce</li>
                        <li>Vybere nÃ¡hodnou otÃ¡zku pro testovÃ¡nÃ­</li>
                        <li>PÅ™i 90%+ postup do dalÅ¡Ã­ lekce</li>
                        <li>PÅ™i <90% opakovÃ¡nÃ­ aktuÃ¡lnÃ­ lekce</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %} 
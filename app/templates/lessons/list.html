{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>Lekce</h1>
    <div>
        <a href="{{ request.url_for('admin_create_lesson_0') }}" class="btn btn-warning me-2">
            ğŸ“ VytvoÅ™it Lekci 0 (VstupnÃ­ test)
        </a>
        <a href="{{ request.url_for('admin_create_lesson_1') }}" class="btn btn-success me-2">
            ğŸ“ VytvoÅ™it Lekci 1 (ZÃ¡klady)
        </a>
        <a href="{{ request.url_for('admin_user_progress') }}" class="btn btn-info me-2">
            ğŸ“Š Pokrok uÅ¾ivatelÅ¯
        </a>
        <a href="{{ request.url_for('admin_new_lesson_get') }}" class="btn btn-primary">NovÃ¡ lekce</a>
    </div>
</div>

<div class="table-responsive">
    <table class="table table-striped">
        <thead>
            <tr>
                <th>NÃ¡zev</th>
                <th>Typ</th>
                <th>OtÃ¡zky</th>
                <th>Jazyk</th>
                <th>VytvoÅ™eno</th>
                <th>Akce</th>
            </tr>
        </thead>
        <tbody>
            {% for lesson in lessons %}
            <tr>
                <td>
                    <strong>{{ lesson.title }}</strong>
                    {% if lesson.description %}
                    <br><small class="text-muted">{{ lesson.description[:100] }}{% if lesson.description|length > 100 %}...{% endif %}</small>
                    {% endif %}
                </td>
                <td>
                    {% if lesson.level == 'entry_test' %}
                        <span class="badge bg-warning text-dark">VstupnÃ­ test</span>
                    {% elif lesson.level == 'beginner' %}
                        <span class="badge bg-success">ZaÄÃ¡teÄnÃ­k</span>
                    {% elif lesson.level == 'intermediate' %}
                        <span class="badge bg-primary">PokroÄilÃ½</span>
                    {% elif lesson.level == 'advanced' %}
                        <span class="badge bg-danger">Expert</span>
                    {% else %}
                        <span class="badge bg-secondary">{{ lesson.level }}</span>
                    {% endif %}
                </td>
                <td>
                    {% if lesson.questions and lesson.questions is iterable and lesson.questions|length > 0 %}
                        {% if lesson.questions[0] is mapping %}
                            {% set enabled_count = lesson.questions | selectattr('enabled', 'equalto', True) | list | length %}
                            <span class="badge bg-info">{{ enabled_count }}/{{ lesson.questions|length }}</span>
                        {% else %}
                            <span class="badge bg-secondary">{{ lesson.questions|length if lesson.questions is iterable else 'N/A' }}</span>
                        {% endif %}
                    {% else %}
                        <span class="badge bg-secondary">0</span>
                    {% endif %}
                </td>
                <td>
                    <span class="badge bg-{{ 'primary' if lesson.language == 'cs' else 'secondary' }}">
                        {{ 'ÄŒeÅ¡tina' if lesson.language == 'cs' else 'AngliÄtina' if lesson.language == 'en' else lesson.language }}
                    </span>
                </td>
                <td>{{ lesson.created_at.strftime('%d.%m.%Y %H:%M') if lesson.created_at else '' }}</td>
                <td>
                    {% if lesson.title.startswith('Lekce 0') or (lesson.questions and lesson.questions is iterable and lesson.questions|length > 0 and lesson.questions[0] is mapping) %}
                        <a href="{{ request.url_for('admin_edit_lesson_get', id=lesson.id) }}" class="btn btn-sm btn-outline-primary">
                            âœï¸ Editovat otÃ¡zky
                        </a>
                    {% else %}
                        <a href="{{ request.url_for('admin_edit_lesson_get', id=lesson.id) }}" class="btn btn-sm btn-outline-primary">
                            Upravit
                        </a>
                    {% endif %}
                    <form method="post" action="{{ request.url_for('admin_delete_lesson', lesson_id=lesson.id) }}" style="display:inline;" onsubmit="return confirm('Opravdu chcete smazat tuto lekci?')">
                        <button type="submit" class="btn btn-sm btn-outline-danger ms-1">ğŸ—‘ï¸</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% if lessons|length == 0 %}
<div class="alert alert-info mt-4">
    <h5><i class="fas fa-info-circle"></i> Jak zaÄÃ­t?</h5>
    <p>ZatÃ­m nemÃ¡te Å¾Ã¡dnÃ© lekce. ZaÄnÄ›te vytvoÅ™enÃ­m <strong>Lekce 0 (VstupnÃ­ test)</strong>:</p>
    <ol>
        <li>KliknÄ›te na tlaÄÃ­tko <strong>"ğŸ“ VytvoÅ™it Lekci 0"</strong> vÃ½Å¡e</li>
        <li>Automaticky se vytvoÅ™Ã­ 30 otÃ¡zek z obrÃ¡bÄ›cÃ­ch kapalin</li>
        <li>PotÃ© mÅ¯Å¾ete otÃ¡zky editovat a zaÅ¡krtÃ¡vat kterÃ© chcete testovat</li>
        <li>UÅ¾ivatelÃ© budou muset dosÃ¡hnout 90% pro postup do Lekce 1</li>
    </ol>
</div>
{% endif %}

<div class="mt-4">
    <div class="card">
        <div class="card-header">
            <h5>ğŸ“Š Legenda systÃ©mu lekcÃ­</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h6>Typy lekcÃ­:</h6>
                    <ul class="list-unstyled">
                        <li><span class="badge bg-warning text-dark">VstupnÃ­ test</span> - Lekce 0 s 30 otÃ¡zkami</li>
                        <li><span class="badge bg-success">ZaÄÃ¡teÄnÃ­k</span> - ZÃ¡kladnÃ­ lekce</li>
                        <li><span class="badge bg-primary">PokroÄilÃ½</span> - PokroÄilÃ© lekce</li>
                        <li><span class="badge bg-danger">Expert</span> - ExpertnÃ­ lekce</li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <h6>Funkce:</h6>
                    <ul class="list-unstyled">
                        <li>âœï¸ <strong>Editovat otÃ¡zky:</strong> ZaÅ¡krtÃ¡vÃ¡nÃ­ aktivnÃ­ch otÃ¡zek</li>
                        <li>ğŸ“Š <strong>PoÄet otÃ¡zek:</strong> AktivnÃ­/Celkem</li>
                        <li>ğŸ¯ <strong>AI testovÃ¡nÃ­:</strong> Jen z aktivnÃ­ch otÃ¡zek</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %} 